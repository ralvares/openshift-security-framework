<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Compliance Beyond Built-in Profiles: Automating Unique Compliance Checks with OpenShift using CustomRule</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Compliance Beyond Built-in Profiles: Automating Unique Compliance Checks with OpenShift using CustomRule</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For security teams responsible for Red Hat OpenShift, the Compliance Operator provides automated baseline checks for common standards (CIS, PCI-DSS, etc.) and produces evidence auditors expect. But auditors and internal policy owners often ask for controls that live outside those standard profiles â€” organization-specific requirements such as mandatory resource labeling, restricting which users can access cardholder-data-processing applications, or enforcing use of a single, central database.</p>
</div>
<div class="paragraph">
<p>Historically, these requests result in manual, brittle checks: ad-hoc scripts, grepping <code>oc</code> outputs, or marking items as "manually verified." The CustomRule Custom Resource (CRD) addresses this gap by letting you codify custom checks using the Common Expression Language (CEL) and run them with the Compliance Operator alongside built-in checks.</p>
</div>
<div class="paragraph">
<p>This article shows how to turn auditor requests into executable CustomRule manifests, add them to a TailoredProfile, and include them in Compliance Operator scans so they produce repeatable, auditable evidence.</p>
</div>
<div class="paragraph">
<div class="title">Note on Feature Status</div>
<p>The CustomRule feature is Tech Preview. It is available for testing and evaluation only and is not supported by Red Hat Technical Support. The API and behavior may change before General Availability (GA). Avoid using Tech Preview features in production clusters.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_the_customrule_crd">Understanding the CustomRule CRD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CustomRule behaves similarly to the existing Rule CRD but uses CEL expressions as the evaluation engine. Key fields in a CustomRule manifest include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expression</code>: the CEL expression that evaluates to <code>true</code> for compliant resources.</p>
</li>
<li>
<p><code>inputs</code>: the Kubernetes API resources the expression evaluates (keeps scans efficient).</p>
</li>
<li>
<p><code>scannerType</code>: must be <code>CEL</code> for CEL-based rules.</p>
</li>
<li>
<p><code>title</code>, <code>description</code>, <code>severity</code>, and <code>failureReason</code>: metadata and actionable guidance when a check fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CEL is a small, expressive language well-suited to policy evaluation; you may have seen it in Kubernetes admission policy contexts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_example_1_audit_cluster_admin_access_with_an_allow_list_aligns_to_cis_5_1_1">Example 1: Audit cluster-admin Access with an Allow-List (aligns to CIS 5.1.1)</h3>
<div class="paragraph">
<p>This CustomRule enforces an allow-list of principals permitted to hold the <code>cluster-admin</code> binding. The rule passes only if every subject bound to the <code>cluster-admin</code> ClusterRole is present in an approved list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">cluster-admin-allow-list</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">description</span><span class="pi">:</span> <span class="pi">|-</span>
<span class="err">	</span><span class="s">	Audits subjects bound to the 'cluster-admin' role against a</span>
<span class="err">	</span><span class="s">	pre-defined allow-list. This aligns with CIS OpenShift</span>
<span class="err">	</span><span class="s">	Benchmark 5.1.1, which recommends restricting 'cluster-admin'</span>
<span class="err">	</span><span class="s">	access. Customize the list for your organization.</span>
<span class="err">	</span><span class="s">failureReason: |-</span>
<span class="err">	</span><span class="s">	Found subject(s) bound to 'cluster-admin' that are NOT</span>
<span class="err">	</span><span class="s">	on the organizational allow-list.</span>
<span class="err">	</span><span class="s">expression: |-</span>
<span class="err">	</span><span class="s">	crbs.items.filter(crb, crb.metadata.name == 'cluster-admin')[0]</span>
<span class="err">	</span><span class="s">		.subjects.all(subject,</span>
<span class="err">	</span><span class="s">			(subject.kind == 'User' &amp;&amp; subject.name in [</span>
<span class="err">	</span><span class="s">				'kubeadmin',</span>
<span class="err">	</span><span class="s">				'system:admin',</span>
<span class="err">	</span><span class="s">				'alice@my-company.com'</span>
<span class="err">	</span><span class="s">			]) ||</span>
<span class="err">	</span><span class="s">			(subject.kind == 'Group' &amp;&amp; subject.name in [</span>
<span class="err">	</span><span class="s">				'system:masters',</span>
<span class="err">	</span><span class="s">				'ocp-sre-team'</span>
<span class="err">	</span><span class="s">			]) ||</span>
<span class="err">	</span><span class="s">			(subject.kind == 'ServiceAccount' &amp;&amp;</span>
<span class="err">	</span><span class="s">				has(subject.namespace) &amp;&amp;</span>
<span class="err">	</span><span class="s">				(subject.namespace + '/' + subject.name) in [</span>
<span class="err">	</span><span class="s">					'openshift-monitoring/prometheus-k8s'</span>
<span class="err">	</span><span class="s">				]</span>
<span class="err">	</span><span class="s">			)</span>
<span class="err">	</span><span class="s">		)</span>
<span class="err">	</span><span class="s">id: cluster_admin_allow_list</span>
<span class="err">	</span><span class="s">checkType: Platform</span>
<span class="err">	</span><span class="s">inputs:</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: rbac.authorization.k8s.io/v1</span>
<span class="err">	</span><span class="s">			resource: clusterrolebindings</span>
<span class="err">	</span><span class="s">		name: crbs</span>
<span class="err">	</span><span class="s">scannerType: CEL</span>
<span class="err">	</span><span class="s">severity: high</span>
<span class="err">	</span><span class="s">title: Audit cluster-admin access against an allow-list</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_2_discover_unapproved_shadow_databases">Example 2: Discover Unapproved (Shadow) Databases</h3>
<div class="paragraph">
<p>This rule checks for pods running common database images outside approved namespaces (for example, <code>central-dba-prod</code>). If a pod runs a database image in a non-approved namespace, the rule fails and the <code>failureReason</code> explains investigation and remediation steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">disallow-shadow-databases</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">description</span><span class="pi">:</span> <span class="pi">|-</span>
<span class="err">	</span><span class="s">	Ensures application teams do not deploy their own 'shadow'</span>
<span class="err">	</span><span class="s">	database instances (e.g., postgres, mysql, mongo, redis). Applications</span>
<span class="err">	</span><span class="s">	must use the centrally managed instance in 'central-dba-prod'.</span>
<span class="err">	</span><span class="s">failureReason: |-</span>
<span class="err">	</span><span class="s">	One or more pods were found running a disallowed database image</span>
<span class="err">	</span><span class="s">	in a namespace not approved for database workloads.</span>

<span class="err">	</span><span class="s">	To find non-compliant pods:</span>
<span class="err">	</span><span class="s">	`oc get pods -A -o json | jq -r '.items[] | "Namespace: \(.metadata.namespace) Pod: \(.metadata.name) Images: \([.spec.containers[].image] | join(","))"' | grep -E "postgres|mysql|mariadb|mongo|redis" | grep -vE "central-dba-prod|openshift-monitoring"`</span>

<span class="err">	</span><span class="s">	Remediation:</span>
<span class="err">	</span><span class="s">	1. Review identified pods.</span>
<span class="err">	</span><span class="s">	2. Delete or reconfigure non-compliant pods to use the approved DB.</span>
<span class="err">	</span><span class="s">	3. Consider admission policies to prevent regressions.</span>
<span class="err">	</span><span class="s">expression: |</span>
<span class="err">	</span><span class="s">	pods.items.all(pod,</span>
<span class="err">	</span><span class="s">		pod.metadata.namespace in [</span>
<span class="err">	</span><span class="s">		'central-dba-prod',</span>
<span class="err">	</span><span class="s">		'openshift-monitoring'</span>
<span class="err">	</span><span class="s">		] ||</span>
<span class="err">	</span><span class="s">		pod.spec.containers.all(container,</span>
<span class="err">	</span><span class="s">			!['postgres', 'mysql', 'mariadb', 'mongo', 'redis'].exists(</span>
<span class="err">	</span><span class="s">				db, container.image.contains(db)</span>
<span class="err">	</span><span class="s">			)</span>
<span class="err">	</span><span class="s">		)</span>
<span class="err">	</span><span class="s">	)</span>
<span class="err">	</span><span class="s">id: disallow_shadow_databases</span>
<span class="err">	</span><span class="s">checkType: Platform</span>
<span class="err">	</span><span class="s">inputs:</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: v1</span>
<span class="err">	</span><span class="s">			resource: pods</span>
<span class="err">	</span><span class="s">		name: pods</span>
<span class="err">	</span><span class="s">scannerType: CEL</span>
<span class="err">	</span><span class="s">severity: high</span>
<span class="err">	</span><span class="s">title: Disallow Unapproved Database Pods in App Namespaces</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_3_verify_allowed_registries_configured">Example 3: Verify Allowed Registries Configured</h3>
<div class="paragraph">
<p>Ensure the cluster&#8217;s image configuration includes required trusted registries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">allowed-registries-configured</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">title</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Allowed</span><span class="nv"> </span><span class="s">registries</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">configured"</span>
<span class="err">	</span><span class="na">description</span><span class="pi">:</span> <span class="pi">|-</span>
<span class="err">	</span><span class="s">	Ensure allowed registries are configured so the container runtime</span>
<span class="err">	</span><span class="s">	only pulls from trusted registries.</span>
<span class="err">	</span><span class="s">severity: medium</span>
<span class="err">	</span><span class="s">failureReason: |-</span>
<span class="err">	</span><span class="s">	The trusted registry 'my-trusted-registry.internal.example.com' was not</span>
<span class="err">	</span><span class="s">	found in 'spec.registrySources.allowedRegistries' for</span>
<span class="err">	</span><span class="s">	the 'image.config.openshift.io/cluster' resource. Patch the cluster image</span>
<span class="err">	</span><span class="s">	configuration to add this registry.</span>
<span class="err">	</span><span class="s">id: allowed-registries-configured</span>
<span class="err">	</span><span class="s">checkType: Platform</span>
<span class="err">	</span><span class="s">scannerType: CEL</span>
<span class="err">	</span><span class="s">inputs:</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: config.openshift.io/v1</span>
<span class="err">	</span><span class="s">			resource: images</span>
<span class="err">	</span><span class="s">		name: imageConfigs</span>
<span class="err">	</span><span class="s">expression: |</span>
<span class="err">	</span><span class="s">	imageConfigs.items.exists(</span>
<span class="err">	</span><span class="s">		img, img.metadata.name == 'cluster' &amp;&amp;</span>
<span class="err">	</span><span class="s">		has(img.spec.registrySources) &amp;&amp;</span>
<span class="err">	</span><span class="s">		img.spec.registrySources != null &amp;&amp;</span>
<span class="err">	</span><span class="s">		has(img.spec.registrySources.allowedRegistries) &amp;&amp;</span>
<span class="err">	</span><span class="s">		img.spec.registrySources.allowedRegistries != null &amp;&amp;</span>
<span class="err">	</span><span class="s">		type(img.spec.registrySources.allowedRegistries) == list &amp;&amp;</span>
<span class="err">	</span><span class="s">		'my-trusted-registry.internal.example.com' in img.spec.registrySources.allowedRegistries</span>
<span class="err">	</span><span class="s">	)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These examples can be combined: enforce that only trusted registries are used while preventing unapproved database images in application namespaces.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integrating_customrule_resources_into_a_scan">Integrating CustomRule Resources into a Scan</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Three steps:</p>
</div>
<div class="paragraph">
<div class="title">Step 1: Create the CustomRule</div>
<p>Apply each <code>CustomRule</code> manifest to the <code>openshift-compliance</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>oc apply -f &lt;your-customrule&gt;.yaml -n openshift-compliance</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Step 2: Add the rules to a <code>TailoredProfile</code></div>
<p>CustomRule resources are included by adding them to a <code>TailoredProfile</code>. Note: a single <code>TailoredProfile</code> cannot mix standard <code>Rule</code> resources and <code>CustomRule</code> resources; keep them separate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">TailoredProfile</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">custom-security-checks</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">description</span><span class="pi">:</span> <span class="s">Custom security compliance profile using CEL-based CustomRules</span>
<span class="na">	enableRules</span><span class="pi">:</span>
<span class="err">		</span><span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">			name</span><span class="pi">:</span> <span class="s">cluster-admin-allow-list</span>
<span class="na">			rationale</span><span class="pi">:</span> <span class="s">CIS 5.1.1 requires auditing cluster-admin bindings against an allow-list</span>
<span class="na">		- kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">			name</span><span class="pi">:</span> <span class="s">disallow-shadow-databases</span>
<span class="na">			rationale</span><span class="pi">:</span> <span class="s">Ensure the usage of a central, managed database</span>
<span class="na">		- kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">			name</span><span class="pi">:</span> <span class="s">allowed-registries-configured</span>
<span class="na">			rationale</span><span class="pi">:</span> <span class="s">Ensure the cluster only pulls images from trusted registries</span>
<span class="na">	title</span><span class="pi">:</span> <span class="s">Custom Security Profile</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Step 3: Execute the scan with a <code>ScanSettingBinding</code></div>
<p>Create a <code>ScanSettingBinding</code> to link the <code>TailoredProfile</code> to scan settings (for example, the <code>default</code> ScanSetting).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ScanSettingBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">custom-security-scan</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">profiles</span><span class="pi">:</span>
<span class="err">	</span><span class="pi">-</span> <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">		kind</span><span class="pi">:</span> <span class="s">TailoredProfile</span>
<span class="na">		name</span><span class="pi">:</span> <span class="s">custom-security-checks</span>
<span class="na">settingsRef</span><span class="pi">:</span>
<span class="err">	</span><span class="na">apiGroup</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">	kind</span><span class="pi">:</span> <span class="s">ScanSetting</span>
<span class="na">	name</span><span class="pi">:</span> <span class="s">default</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reviewing_scan_results">Reviewing Scan Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After the <code>ScanSettingBinding</code> is applied the Compliance Operator will run the scan. To view results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>oc get compliancecheckresults</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>NAME                                                      STATUS   SEVERITY
custom-security-scan-cluster-admin-allow-list             FAIL     high
custom-security-scan-disallow-shadow-databases            FAIL     high
custom-security-scan-allowed-registries-configured        FAIL     high</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>FAIL</code> indicates the rule executed and identified non-compliant resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_best_practices_for_authoring_customrules">Best Practices for Authoring CustomRules</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Passing logic:</strong> CEL expressions should evaluate to <code>true</code> when compliant.</p>
</li>
<li>
<p><strong>Descriptive names:</strong> Use specific <code>metadata.name</code> values (e.g., <code>disallow-hostpath-volumes</code>).</p>
</li>
<li>
<p><strong>Helpful descriptions:</strong> Use <code>spec.description</code> to explain the risk and include commands to find violating resources.</p>
</li>
<li>
<p><strong>Actionable <code>failureReason</code>:</strong> Describe exact remediation steps administrators should take.</p>
</li>
<li>
<p><strong>Resource efficiency:</strong> In <code>spec.inputs</code>, request only the resources required by the expression.</p>
</li>
<li>
<p><strong>Keep IDs consistent:</strong> Make <code>spec.id</code> and <code>metadata.name</code> similar to reduce ambiguity.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_troubleshooting">Basic Troubleshooting</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>CustomRule status:</strong> <code>oc get customrule &lt;your-rule&gt; -o yaml</code> â€” an invalid CEL expression will put the rule into an Error state; the rule must be <code>Ready</code> to be added to a <code>TailoredProfile</code>.</p>
</li>
<li>
<p><strong>TailoredProfile status:</strong> Ensure the <code>TailoredProfile</code> is <code>Ready</code> before referencing it in a <code>ScanSettingBinding</code>.</p>
</li>
<li>
<p><strong>Do not mix types:</strong> A <code>TailoredProfile</code> cannot include both <code>Rule</code> and <code>CustomRule</code> kinds.</p>
</li>
<li>
<p><strong>Rescanning:</strong> After modifying a CustomRule, re-run scans by annotating <code>ComplianceScan</code> resources to re-generate <code>ComplianceCheckResult</code> objects.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope_limitations">Scope &amp; Limitations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>CustomRule currently supports platform-level checks against Kubernetes and OpenShift API resources (Pods, Roles, cluster configuration, etc.). It does not support host-level checks (files, host processes, permissions). For host-level checks continue using existing node <code>Rule</code> resources shipped with the Compliance Operator. Host-level scanning may be considered in future releases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_support_feedback">Support &amp; Feedback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This feature is Tech Preview. For feedback, file issues, or questions, contact Red Hat Support through the Red Hat Customer Portal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Next Steps</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Install the Compliance Operator from OperatorHub via OLM if not already present.</p>
</li>
<li>
<p>Start by applying example <code>CustomRule</code> manifests and creating a <code>TailoredProfile</code> and <code>ScanSettingBinding</code> in a test cluster.</p>
</li>
<li>
<p>Share feedback and example rules with the project to help stabilize the feature.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>CustomRule example repository: <a href="https://github.com/ComplianceAsCode/compliance-operator/tree/master/config/samples/custom-rules" class="bare">https://github.com/ComplianceAsCode/compliance-operator/tree/master/config/samples/custom-rules</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_networkpolicy_rules_detect_allow_all_and_require_deny_all_in_scoped_namespaces">NetworkPolicy Rules: detect allow-all and require deny-all in scoped namespaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enforce NetworkPolicy requirements using two approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>CustomRule</code> (CEL) that scans existing <code>NetworkPolicy</code> resources and flags "allow-all" policies in namespaces you choose via a namespace label.</p>
</li>
<li>
<p>A separate <code>CustomRule</code> that ensures each labeled namespace has a "deny-all" policy (a <code>NetworkPolicy</code> that selects all pods and has no ingress/egress rules), ensuring isolation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below are two <code>CustomRule</code> examples that scope enforcement to namespaces with the label <code>compliance/enforce-networkpolicies=true</code>. Modify the label key/value to match your organization.</p>
</div>
<div class="sect2">
<h3 id="_detect_allow_all_networkpolicies_in_labeled_namespaces">Detect allow-all NetworkPolicies in labeled namespaces</h3>
<div class="paragraph">
<p>This rule passes only when no "allow-all" NetworkPolicies exist in namespaces labeled <code>compliance/enforce-networkpolicies=true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">netpol-disallow-allow-all-in-labeled-namespaces</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">title</span><span class="pi">:</span> <span class="s">Disallow allow-all NetworkPolicies in labeled namespaces</span>
<span class="na">	description</span><span class="pi">:</span> <span class="pi">|-</span>
<span class="err">	</span><span class="s">	Flags NetworkPolicies that permit all traffic (empty podSelector plus</span>
<span class="err">	</span><span class="s">	empty ingress/egress rules) in namespaces labeled</span>
<span class="err">	</span><span class="s">	`compliance/enforce-networkpolicies=true`.</span>
<span class="err">	</span><span class="s">failureReason: |-</span>
<span class="err">	</span><span class="s">	One or more "allow-all" NetworkPolicies were found in namespaces</span>
<span class="err">	</span><span class="s">	labeled `compliance/enforce-networkpolicies=true`. Replace them with</span>
<span class="err">	</span><span class="s">	more restrictive NetworkPolicies or remove the namespace label to opt-out.</span>
<span class="err">	</span><span class="s">id: netpol_disallow_allow_all_labeled</span>
<span class="err">	</span><span class="s">checkType: Platform</span>
<span class="err">	</span><span class="s">scannerType: CEL</span>
<span class="err">	</span><span class="s">inputs:</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: networking.k8s.io/v1</span>
<span class="err">	</span><span class="s">			resource: networkpolicies</span>
<span class="err">	</span><span class="s">		name: netpols</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: v1</span>
<span class="err">	</span><span class="s">			resource: namespaces</span>
<span class="err">	</span><span class="s">		name: namespaces</span>
<span class="err">	</span><span class="s">expression: |</span>
<span class="err">	</span><span class="s">	!netpols.items.exists(np,</span>
<span class="err">	</span><span class="s">		namespaces.items.exists(ns,</span>
<span class="err">	</span><span class="s">			ns.metadata.name == np.metadata.namespace &amp;&amp;</span>
<span class="err">	</span><span class="s">			ns.metadata.labels['compliance/enforce-networkpolicies'] == 'true'</span>
<span class="err">	</span><span class="s">		) &amp;&amp;</span>
<span class="err">	</span><span class="s">		np.spec.podSelector == {} &amp;&amp;</span>
<span class="err">	</span><span class="s">		(</span>
<span class="err">	</span><span class="s">			(has(np.spec.ingress) &amp;&amp; size(np.spec.ingress) == 1 &amp;&amp; np.spec.ingress[0] == {}) ||</span>
<span class="err">	</span><span class="s">			(has(np.spec.egress)  &amp;&amp; size(np.spec.egress)  == 1 &amp;&amp; np.spec.egress[0]  == {})</span>
<span class="err">	</span><span class="s">		)</span>
<span class="err">	</span><span class="s">	)</span>
<span class="err">	</span><span class="s">severity: high</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The expression returns <code>true</code> (pass) only if there are no matching allow-all NetworkPolicies in labeled namespaces.</p>
</li>
<li>
<p>Adjust the label key/value to match your environment.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_require_a_deny_all_networkpolicy_in_labeled_namespaces">Require a deny-all NetworkPolicy in labeled namespaces</h3>
<div class="paragraph">
<p>This rule ensures every namespace labeled <code>compliance/enforce-networkpolicies=true</code> has at least one "deny-all" NetworkPolicy that selects all pods and defines no ingress/egress rules (i.e., defaults to denying traffic).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">compliance.openshift.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomRule</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">netpol-require-deny-all-in-labeled-namespaces</span>
<span class="na">	namespace</span><span class="pi">:</span> <span class="s">openshift-compliance</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">title</span><span class="pi">:</span> <span class="s">Require deny-all NetworkPolicy in labeled namespaces</span>
<span class="na">	description</span><span class="pi">:</span> <span class="pi">|-</span>
<span class="err">	</span><span class="s">	Validates that namespaces labeled `compliance/enforce-networkpolicies=true`</span>
<span class="err">	</span><span class="s">	include at least one NetworkPolicy that selects all pods and contains no</span>
<span class="err">	</span><span class="s">	ingress/egress rules (deny-all). This helps ensure network isolation.</span>
<span class="err">	</span><span class="s">failureReason: |-</span>
<span class="err">	</span><span class="s">	One or more labeled namespaces do not contain a deny-all NetworkPolicy.</span>
<span class="err">	</span><span class="s">	Add a NetworkPolicy with `podSelector: {}` and no `ingress`/`egress`</span>
<span class="err">	</span><span class="s">	rules (and `policyTypes: ["Ingress","Egress"]` if you need both).</span>
<span class="err">	</span><span class="s">id: netpol_require_deny_all_labeled</span>
<span class="err">	</span><span class="s">checkType: Platform</span>
<span class="err">	</span><span class="s">scannerType: CEL</span>
<span class="err">	</span><span class="s">inputs:</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: networking.k8s.io/v1</span>
<span class="err">	</span><span class="s">			resource: networkpolicies</span>
<span class="err">	</span><span class="s">		name: netpols</span>
<span class="err">	</span><span class="s">	- kubernetesInputSpec:</span>
<span class="err">	</span><span class="s">			apiVersion: v1</span>
<span class="err">	</span><span class="s">			resource: namespaces</span>
<span class="err">	</span><span class="s">		name: namespaces</span>
<span class="err">	</span><span class="s">expression: |</span>
<span class="err">	</span><span class="s">	namespaces.items.all(ns,</span>
<span class="err">	</span><span class="s">		ns.metadata.labels['compliance/enforce-networkpolicies'] != 'true' ||</span>
<span class="err">	</span><span class="s">		netpols.items.exists(np,</span>
<span class="err">	</span><span class="s">			np.metadata.namespace == ns.metadata.name &amp;&amp;</span>
<span class="err">	</span><span class="s">			np.spec.podSelector == {} &amp;&amp;</span>
<span class="err">	</span><span class="s">			(!has(np.spec.ingress) || size(np.spec.ingress) == 0) &amp;&amp;</span>
<span class="err">	</span><span class="s">			(!has(np.spec.egress)  || size(np.spec.egress)  == 0)</span>
<span class="err">	</span><span class="s">		)</span>
<span class="err">	</span><span class="s">	)</span>
<span class="err">	</span><span class="s">severity: high</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This expression evaluates to <code>true</code> only when every labeled namespace either
has a deny-all NetworkPolicy or is not labeled for enforcement.</p>
</li>
<li>
<p>You may prefer separate deny-all policies for ingress and egress depending on
operational constraints; adjust the expression accordingly.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_scoping_a_validatingadmissionpolicy_to_labeled_namespaces">Scoping a ValidatingAdmissionPolicy to labeled namespaces</h3>
<div class="paragraph">
<p>If you also use <code>ValidatingAdmissionPolicy</code> (admission-time blocking) you can limit enforcement to namespaces with a label using <code>matchConstraints.namespaceSelector</code>. Example (Kubernetes <code>admissionregistration.k8s.io/v1</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">admissionregistration.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ValidatingAdmissionPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
<span class="err">	</span><span class="na">name</span><span class="pi">:</span> <span class="s">block-allow-all-netpol</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="err">	</span><span class="na">failurePolicy</span><span class="pi">:</span> <span class="s">Fail</span>
<span class="na">	matchConstraints</span><span class="pi">:</span>
<span class="err">		</span><span class="na">resourceRules</span><span class="pi">:</span>
<span class="err">			</span><span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">networking.k8s.io"</span><span class="pi">]</span>
<span class="err">				</span><span class="na">apiVersions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">v1"</span><span class="pi">]</span>
<span class="err">				</span><span class="na">operations</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CREATE"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">UPDATE"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">PATCH"</span><span class="pi">]</span>
<span class="err">				</span><span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">networkpolicies"</span><span class="pi">]</span>
<span class="err">		</span><span class="na">namespaceSelector</span><span class="pi">:</span>
<span class="err">			</span><span class="na">matchLabels</span><span class="pi">:</span>
<span class="err">				</span><span class="na">compliance/enforce-networkpolicies</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="err">	</span><span class="na">validations</span><span class="pi">:</span>
<span class="err">		</span><span class="pi">-</span> <span class="na">expression</span><span class="pi">:</span> <span class="s2">"</span><span class="s">!(</span>
<span class="err">				</span><span class="s">object.spec.podSelector</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">{}</span><span class="nv"> </span><span class="s">&amp;&amp;</span>
<span class="err">				</span><span class="s">(</span>
<span class="err">					</span><span class="s">(has(object.spec.ingress)</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">size(object.spec.ingress)</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">object.spec.ingress[0]</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">{})</span><span class="nv"> </span><span class="s">||</span>
<span class="err">					</span><span class="s">(has(object.spec.egress)</span><span class="nv">  </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">size(object.spec.egress)</span><span class="nv">  </span><span class="s">==</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">object.spec.egress[0]</span><span class="nv">  </span><span class="s">==</span><span class="nv"> </span><span class="s">{})</span>
<span class="err">				</span><span class="s">)</span>
<span class="err">			</span><span class="s">)"</span>
<span class="err">			</span><span class="na">message</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Allow-all</span><span class="nv"> </span><span class="s">NetworkPolicies</span><span class="nv"> </span><span class="s">(empty</span><span class="nv"> </span><span class="s">{}</span><span class="nv"> </span><span class="s">ingress/egress</span><span class="nv"> </span><span class="s">rules)</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">forbidden</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">labeled</span><span class="nv"> </span><span class="s">namespaces.</span><span class="nv"> </span><span class="s">Deny-all</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">allowed."</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: <code>namespaceSelector</code> limits the admission policy to matching namespaces; adapt the label to your convention.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_end_of_networkpolicy_rules">End of NetworkPolicy Rules</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-11-21 18:30:42 +0400
</div>
</div>
</body>
</html>